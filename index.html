<!DOCTYPE html>
<html lang="en">
<head>
  
  <meta charset="UTF-8" >
  <meta name="viewport" content="width=device-width, initial-scale=1.0" >
  <title>Find Bono the Hidden Character - Daily Puzzle Game</title>
  <meta
    name="description"
    content="Play a new hidden-character game each day— find Bono the elephant, earn medals and streaks!">
    <link rel="canonical" href="https://findbono.com/" >
  <meta property="og:title"       content="Find Bono – Daily Puzzle" >
  <meta property="og:description" content="Test your speed finding Bono—new puzzle daily!" >
  <meta property="og:image"       content="https://findbono.com/images/preview.jpg" >
  <meta property="og:url"         content="https://findbono.com/" >
  <meta name="twitter:card"        content="summary_large_image" >

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"Game",
    "name":"Find Bono",
    "url":"https://findbono.com/",
    "description":"Find Bono hidden in an image as fast as you can—new puzzle daily!",
    "image":"https://findbono.com/images/preview.jpg"
  }
  </script>
    <meta name="robots" content="index,follow" >
  <meta name="theme-color" content="#ffffff" >
  <meta name="apple-mobile-web-app-capable" content="yes" >
<meta name="apple-mobile-web-app-status-bar-style" content="default" >
<meta name="twitter:site" content="@findbono" >
<meta name="twitter:creator" content="@findbono" >
<link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" >
 <link rel="manifest" href="/manifest.json" >
 <link rel="icon" href="/favicon.ico" >
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" >

<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">



<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css"
>
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js"></script>
<script>
  // your existing loadGA() from earlier:
  function loadGA(){
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-PM9CKCQFNV', { anonymize_ip: true });
    const s = document.createElement('script');
    s.async = true;
    s.src   = 'https://www.googletagmanager.com/gtag/js?id=UA-XXXXXXX-1';
    document.head.appendChild(s);
  }

  window.addEventListener('load', function(){
    window.cookieconsent.initialise({
      palette: {
        popup:  { background: "#000" },
        button: { background: "#f1d600" }
      },
      theme: "classic",
      type: "opt-in",         // only load GA after consent
      content: {
        message: "We use cookies to measure traffic.  Accept to help us improve.",
        dismiss: "Accept",
        deny: "Decline",
        link: "Learn more",
        href: "/privacy-policy.html"
      },
      onInitialise: function(status) {
        if (this.hasConsented()) {
          loadGA();
        }
      },
      onStatusChange: function(status) {
        if (this.hasConsented()) {
          loadGA();
        }
      }
    });
  });
</script>









  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --accent: #333;      /* charcoal button */
      --modal-bg: #fff;    /* white modal background */
      --text-light: #333;  /* dark text */
      
    }
    /* Page layout */
    html, body {
      margin: 0;
      padding: 0;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #f0f0f0;
      font-family: 'Montserrat', sans-serif;
    }
    /* Entrance animation */
    @keyframes popIn {
      from { opacity: 0; transform: scale(0.8); }
      to { opacity: 1; transform: scale(1); }
    }
    /* Intro modal */
    #intro-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    /* Timer modal (hidden until used) */
    #timer-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1001;
    }
    #timer-modal #modal-content {
      padding-top: 40px;   
      width: 18vw;     /* or any % of the viewport you like */
    }
    /* Shared modal content styles */
    #intro-content,
    #modal-content {
      background: var(--modal-bg);
      color: var(--text-light);
      padding: 20px 30px;
      border-radius: 8px;
      max-width: 90vw;
      
       margin: 0 5vw;
      text-align: center;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
      animation: popIn 0.3s ease-out;
      position: relative;
    }
    /* Intro specifics */
    #intro-content img {
      max-width: 150px;
      height: auto;
      margin-bottom: 15px;
      border-radius: 10%;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    #intro-content h2 {
      margin: 0 0 10px;
      font-size: 1.8em;
      font-weight: 600;
    }
    #intro-content ul {
      text-align: left;
      padding-left: 20px;
      margin: 10px 0;
      list-style: disc outside;
    }
    /* Button styles */
    button {
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 10px 20px;
      font-size: 1em;
      cursor: pointer;
      font-weight: 600;
      transition: transform 0.2s ease, filter 0.2s ease;
    }
    button:hover {
      transform: scale(1.05);
      filter: brightness(1.1);
    }
    /* Close button spacing */
    #close-btn {
      margin-top: 15px;
    }
    #x-btn {
      
    }
    #stats-btn {
      background: var(--modal-bg);
      box-shadow: 0 8px 20px rgba(0,0,0,0.4);
      stroke: var(--accent);   
      display: flex;
      align-items: center;
      vertical-align:top;
      line-height: 68px;
      text-align: center;
      width: 50px;            
      height: 50px;
      padding: 0;             
      border-radius: 50%;     
      cursor: pointer;
      position:fixed; bottom:85px; left:348px; z-index:1100
    }    
    #share-btn {
      background: var(--modal-bg);
      box-shadow: 0 8px 20px rgba(0,0,0,0.4);
      stroke: var(--accent);
      text-align: center;
      line-height: 75px;
      width: 50px;            
      height: 50px;
      border-radius: 50%;     
      cursor: pointer; position:fixed; bottom:20px; left:348px; z-index:1100; 
    } 
    .game-button.blurred {
      filter: blur(4px);
      opacity: 0.7;
    }
    /* Image container */
    #image-container {
      position: relative;
      max-width: 100vw;
      max-height: 100vh;
    }
    #main-image {
      display: block;
      max-width: 100vw;
      max-height: 100vh;
      width: auto;
      height: auto;
      object-fit: contain;
    }
    /* Click zone */
    #click-zone {
      position: absolute;
      top: 66%;    /* adjust as needed */
      left: 43%;   /* adjust as needed */
      width: 25px; /* original size */
      height: 75px;/* original size */
      cursor: pointer;
              /*background: black; */
      opacity: 0.8;
      z-index: 10;
    }
    .bonus-zone {
      position: absolute;
      
      cursor: pointer;
      z-index: 9;
    }
    #bonus-zone-1 { top: 10%; /*background: rgb(255, 0, 0)*/; opacity: 0.8; left: 60%; width: 100px; height: 80px; }
		#bonus-zone-2 { top: 50%; /*background: rgb(238, 255, 0)*/; opacity: 0.8; left: 80%; width: 120px; height: 90px; }
    #found-panel {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: var(--modal-bg);
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
      display: flex;
      gap: 20px;
      z-index: 500;
    }
    #found-panel img {
      width: 80px;
      height: 80px;
      object-fit: contain;
      opacity: 0.5;
      transition: opacity 0.2s ease, transform 0.2s ease;
    }
    #found-panel img.found {
      opacity: 1;
      transform: scale(1.1);
    }
    /* Timer text styling */
    #modal-content p {
      margin: 0;
      font-size: 2.4em;
      margin-bottom: 0.3em;  
      font-weight: bold;
    }
    .medal-large {
      width: 80px;
      height: auto; 
    }
    .medal-large.medal-amethyst {
      filter:
        drop-shadow(0 0 8px rgba(153,102,204,0.8))
        drop-shadow(0 0 16px rgba(153,102,204,0.6));   
    }
    .medal-large.medal-gold {
      filter: 
        drop-shadow(0 0 10px gold)
        drop-shadow(0 0 20px rgba(255,215,0,0.5));
    }
    .medal-large.medal-silver {
        filter:
          drop-shadow(0 0 8px rgba(192,192,192,0.8))
          drop-shadow(0 0 16px rgba(192,192,192,0.6));
    }
    .medal-large.medal-bronze {
        filter:
          drop-shadow(0 0 8px rgba(205,127,50,0.8))
          drop-shadow(0 0 16px rgba(205,127,50,0.6));
    }
    #medal-stats {
      display: flex;
      gap: 4rem;             /* space between the two items */
      justify-content: center; /* or flex-start / flex-end */
      margin-top: 1.5em;       /* tweak vertical spacing */
    }
    #medal-stats .stat-row {
      display: flex;
      flex-direction: column;  /* stack image above text */
      align-items: center;     /* center horizontally */
    }
    #medal-stats img {
      width: 30px;  /* or whatever size you like */
      height: 45px;
      margin-bottom: 0.5em;
    }
    #medal-stats span{
      font-size: 1.2em; /* size of the number */
      font-weight: 600;
    }
    #score-stats {
      display: flex;
      justify-content: center;   /* spread the three blocks evenly */
      gap: 60px;                  /* space between each stat-block */
      text-align: center;         /* centre text under each number */
    }
    #score-stats .stat-block {
      display: flex;
      flex-direction: column;     /* stack number over label */
      align-items: center;        /* centre them horizontally */
    }
    .stat-value {
      font-size: 2em;
      font-weight: bold;
    }
    .stat-label {
      font-size: 0.9em;
    }
    #medal-bars {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 1em;
    }
    #medal-bars img {
      width: 26px;
      height: 35px;
    }
    .bar-row {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .bar-container {
      flex: 1;                    /* take up remaining width */
      height: 35px;               /* bar height */
      /*background: #eee;           /* track background */
      border-radius: 4px; 
      overflow: hidden;
    }
    .bar-row.bar-amethyst.current .bar-fill { background: rebeccapurple; }
    .bar-row.bar-gold.current .bar-fill  { background: gold; }
    .bar-row.bar-silver.current   .bar-fill { background: silver; }
    .bar-row.bar-bronze.current   .bar-fill { background: peru;  } /* or your bronze hue */
    .bar-fill {
      height: 100%;
      background: none;

      background: var(--accent); /*  your charcoal color */
      /*border-radius: 6px 0 0 6px;  rounded left edge */
    }
    .bar-value {
      width: 1em;                /* fixed width for number alignment */
      text-align: right;
      font-size: 1.2em;
      font-weight: 600;
    }
.clickable:focus {
  outline: 3px solid var(--accent);
  outline-offset: 2px;
}
/* same for your stats/share buttons if they’re not native <button>s */
#stats-btn:focus,
#share-btn:focus {
  outline: 3px solid var(--accent);
  outline-offset: 2px;
}
#x-btn:focus
 {
  outline: 3px solid var(--accent);
  outline-offset: 2px;
}
@media (orientation: portrait) and (max-width: 1250px) {
  #score-stats {
  
    gap: 0.2rem;
  }
  #score-stats .stat-block .stat-label {
    font-size: 0.8em;
  }
 #timer-modal #modal-content{
width: 95vw;
 margin: 0 2.5vw;
 }
 #found-panel {
    
      width: 60vw;
    }
    #stats-btn {

      position: fixed;
right: 8vw;

left:auto;
    }#share-btn {

      position: fixed;
right: 8vw;

left:auto;
    }
   
    
}
@media (max-width: 400px) {
  #intro-content {
    width: 95vw;
    margin: 0 2.5vw;
  }}
  @media (orientation: landscape) and (max-height: 600px) {
    #stats-btn {

      position: fixed;
right: 11vw;
top:83vh;
left:auto;
    }#share-btn {

      position: fixed;

right: 2vw;
top:83vh;
left:auto;
    }
#timer-modal #modal-content{
width: 95vw;
 position: relative;
 margin: 0 2.5vw;
 max-height: 75vh;
} #found-panel {
    flex-direction: column; /* instead of the default row */
    align-items: flex-start; /* optional: left-align the images */
    gap: 1rem;     }
#close-btn {
  position: absolute;
  top: 18rem;
  right: 3rem;
}

 #score-stats .stat-block .stat-label {
    font-size: 0.8em;
  }
#medal-bars {
      display: flex;
      flex-direction: row;
      gap: 8px;
      
    }
    #medal-stats {
       position: absolute;
  top: 50rem;
 

      display: flex;
      gap: 4rem;             /* space between the two items */
      justify-content: center; /* or flex-start / flex-end */
         /* tweak vertical spacing */

    }
    #medal-stats .stat-row {
      
      display: flex;
      flex-direction:row;  /* stack image above text */
      align-items: center;     /* center horizontally */
    }
}
  </style>
  
 
</head>
<body>
   

  
<stats-btn id="stats-btn" class="game-button clickable" role="button" aria-label="View stats" style="display:none; "
  tabindex="0">
    <svg  role="img" aria-label="View your game statistics"  focusable="false" stroke-width="2" width="36" height="36" viewBox="0 0 16 17" fill="none"  >
<rect x="0.5" y="7.5" width="5" height="9" />
<rect x="5.5" y="0.5" width="5" height="16" />
<rect x="10.5" y="4.5" width="5" height="12" />
</svg>
  </stats-btn>









  <share-btn id="share-btn" class="game-button clickable" role="button" aria-label="Share this puzzle" 
 
  tabindex="0"
        >
  <svg width="36" height="36" viewBox="0 0 17 16" fill="#333" xmlns="http://www.w3.org/2000/svg" overflow="visible" role="img" aria-label="Share this puzzle" focusable="false">
<circle cx="2" cy="8" r="2"/>
<circle cx="11" cy="3" r="2" />
<circle cx="11" cy="13" r="2" />
<line x1="0.742752" y1="8.57125" x2="10.7428" y2="2.57125" />
<line x1="10.7428" y1="13.4287" x2="0.742752" y2="7.42875" />
</svg>
  </share-btn>

  <!-- Intro Modal -->
  <div id="intro-modal">
    <div id="intro-content">
      <img src="character.png" alt="Hidden Character" >
      <h2>How To Play</h2>
      <ul>
        <li>Find Bono and click on him!</li>
        <li>Find the golden peanut or todays daily item for a time bonus!</li>
      </ul>
      <button id="start-btn">Let's Go!</button>
    </div>
  </div>

  <!-- Main Image -->
  <div id="image-container">
    <img id="main-image" src="your-image.jpg" alt="Today's puzzle image" >
    <div id="click-zone"></div>
						<div id="bonus-zone-1" class="bonus-zone"></div>
        					<div id="bonus-zone-2" class="bonus-zone"></div>
  </div>




  <div id="found-panel"></div>


  <!-- Timer Modal -->
  <div id="timer-modal">
    <div id="modal-content">
      <p id="time-display"></p>
      <div id="results-body"></div>

      
      <x-btn id="x-btn" style= "position:absolute; top:1em; right:1em; background:none; border:none; font-size:1.2em; cursor:pointer; " class="clickable"
 
  tabindex="0"><svg  xmlns="http://www.w3.org/2000/svg"
 width="30pt" height="30pt" viewBox="0 0 1080.000000 1080.000000"
 preserveAspectRatio="xMidYMid meet">

<g transform="translate(0.000000,1080.000000) scale(0.100000,-0.100000)"
fill="#333" stroke="none">
<path d="M1863 9396 c-102 -26 -163 -65 -279 -181 -120 -120 -161 -187 -184
-300 -22 -109 8 -243 76 -335 18 -25 704 -715 1523 -1535 l1491 -1490 377 378
378 377 -1490 1491 c-820 819 -1510 1505 -1535 1523 -95 70 -246 101 -357 72z"/>
<path d="M8733 9395 c-129 -35 -56 34 -1663 -1571 l-1515 -1514 378 -377 377
-378 1491 1490 c819 820 1505 1510 1523 1535 97 132 109 301 33 460 -44 92
-225 273 -317 317 -111 53 -207 65 -307 38z"/>
<path d="M2974 3728 c-1231 -1233 -1515 -1522 -1533 -1561 -72 -158 -64 -301
25 -448 50 -83 215 -237 294 -276 158 -76 328 -64 460 33 25 18 715 704 1535
1523 l1490 1491 -375 375 c-206 206 -377 375 -380 375 -3 0 -685 -681 -1516
-1512z"/>
<path d="M5930 4865 l-375 -375 1490 -1491 c820 -819 1510 -1505 1535 -1523
132 -97 302 -109 460 -33 79 39 244 193 294 276 89 147 97 290 25 448 -18 39
-302 328 -1533 1561 -831 831 -1513 1512 -1516 1512 -3 0 -174 -169 -380 -375z"/>
</g>
</svg>
</x-btn>
      
      
  
      
      
      
      
      <button id="close-btn">Share</button>


    </div>
  </div>

  <script>
    let foundIndices = JSON.parse(localStorage.getItem('foundIndices')||'[]');
    let foundPanelImgs = []; 



    //acessibility buttons
    document.querySelectorAll('.clickable').forEach(el => {
  el.addEventListener('keydown', e => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      el.click();
    }
  });
});



			const todayKey = new Date().toISOString().slice(0,10); //new Date().toISOString().slice(0,10);


//test mode
      const testMode     = false;      
      const testDuration = 15 * 1000; 
// Fetch the JSON config 
const lastDay  = localStorage.getItem('lastPlayedDay');
  const saved    = localStorage.getItem('lastResult');   //READD SLASH
 document.addEventListener('DOMContentLoaded', () => {
    
     const saved    = localStorage.getItem('lastResult');

/////////////if we are in test mode
 if (testMode) {
    // in test, only auto-show if we're still within testDuration
    const lastTs = parseInt(localStorage.getItem('lastPlayTs')||'0', 10);
    if (Date.now() - lastTs < testDuration) {
      // still locked out → re-show lastResult
      const saved = localStorage.getItem('lastResult');
      if (saved) {
        lastResult = JSON.parse(saved);
        renderStats(lastResult);
        timerModal.style.display = 'flex';
        statsBtn.style.display  = 'block';
        introModal.style.display = 'none';
      }
    }
  } else {
    // in production, auto-show if lastPlayedDay === today
    const lastDay = localStorage.getItem('lastPlayedDay');
    const saved   = localStorage.getItem('lastResult');
    if (lastDay === todayKey && saved) {
      lastResult = JSON.parse(saved);
      renderStats(lastResult);
      timerModal.style.display = 'flex';
      statsBtn.style.display  = 'block';
      introModal.style.display = 'none';
    }
  }
 });


document.addEventListener('DOMContentLoaded', () => {
fetch('/config/dailyConfig.json')    //READD SLASH!!!!!!!
  .then(res => res.json())
  .then(config => {
    const today = config[todayKey];
    if (!today) return; // no entry for today
 







    // 1) Set the main image
    const mainImage = document.getElementById('main-image');
    mainImage.src = today.mainImage;
    mainImage.alt = `Puzzle for ${todayKey}`;

    // 2) Position the click-zone
    const cz = document.getElementById('click-zone');
    Object.assign(cz.style, {
      top:    today.clickZone.top,
      left:   today.clickZone.left,
      width:  today.clickZone.width,
      height: today.clickZone.height
    });
    // 2) Position the bonus-zones
    const bz1 = document.getElementById('bonus-zone-1');
    Object.assign(bz1.style, {
      top:    today.bonusZone1.top,
      left:   today.bonusZone1.left,
      width:  today.bonusZone1.width,
      height: today.bonusZone1.height
    });

    const bz2 = document.getElementById('bonus-zone-2');
    Object.assign(bz2.style, {
      top:    today.bonusZone2.top,
      left:   today.bonusZone2.left,
      width:  today.bonusZone2.width,
      height: today.bonusZone2.height
    });

    // 3) Build the found-items panel
    const panel = document.getElementById('found-panel');
    panel.innerHTML = ''; // remove any hard-coded imgs
    today.foundPanel.forEach(src => {
      const img = document.createElement('img');
      img.src = src;
      img.alt = 'hidden object';
      panel.appendChild(img);
    });
    foundPanelImgs = panel.querySelectorAll('img');
  foundIndices.forEach(i => {
  if (foundPanelImgs[i]) {
    foundPanelImgs[i].classList.add('found');
  }
});
  })
  .catch(err => console.error('dailyConfig.json load failed', err));	

});



    let startTime;
    let elapsed;
    let timerRunning = false;
let bonusAccum = 0;
document.querySelectorAll(".game-button").forEach(btn =>
  btn.classList.add("blurred")
);
    const introModal = document.getElementById('intro-modal');
// Try to resume an in-progress run
				//const todayKey = new Date().toISOString().slice(0,10);  // “YYYY-MM-DD”
				const savedStart = localStorage.getItem('gameStart');
				const savedDay   = localStorage.getItem('startDay');
				const savedBonus = parseInt(localStorage.getItem('bonusAccum'), 10) || 0;

				if (savedStart && savedDay === todayKey) {
  				// Resume today’s game
  				startTime    = parseInt(savedStart, 10);
  				bonusAccum   = savedBonus;
  				timerRunning = true;
  				introModal.style.display = 'none';
          document.querySelectorAll(".game-button").forEach(btn =>
  btn.classList.remove("blurred")

);
				}
    const startBtn = document.getElementById('start-btn');
    const clickZone = document.getElementById('click-zone');
    const timerModal = document.getElementById('timer-modal');
    const timeDisplay = document.getElementById('time-display');
    const closeBtn = document.getElementById('close-btn');
    const xbtn = document.getElementById('x-btn');
//const foundPanelImgs = document.querySelectorAll('#found-panel img');

const usedBonuses = JSON.parse(localStorage.getItem('usedBonuses') || '[]');
// helper to visually and functionally disable a zone
function disableZone(el) {
  el.style.pointerEvents = 'none';
  el.style.opacity       = '0.3';
}
// immediately disable any zones in the usedBonuses array
usedBonuses.forEach(id => {
  const el = document.getElementById(id);
  if (el) disableZone(el);
});

const bonus1 = document.getElementById('bonus-zone-1');
const bonus2 = document.getElementById('bonus-zone-2');

function handleBonus1() {
  applyBonus(0);              // subtract 100 ms
  
  console.log(`Bonus 1 used, total bonus = ${bonusAccum} ms`);

if (foundPanelImgs[1]) {
    foundPanelImgs[1].classList.add('found');
    if (!foundIndices.includes(1)) {
  foundIndices.push(1);
  localStorage.setItem('foundIndices', JSON.stringify(foundIndices));
}
}
usedBonuses.push('bonus-zone-1');
  localStorage.setItem('usedBonuses', JSON.stringify(usedBonuses));
  // 2) disable it immediately
  disableZone(bonus1);
  // (optional) remove the listener too
  bonus1.removeEventListener('click', handleBonus1);
let bonus1Count = parseInt(localStorage.getItem('bonus1Count') || '0', 10);
  bonus1Count++;
  localStorage.setItem('bonus1Count', bonus1Count);
  // Then remove this listener so it can only fire once
 // bonus1.removeEventListener('click', handleBonus1);
  // (Optional) Give visual feedback that it’s been used:
 // bonus1.style.opacity = '0.3';
 // bonus1.style.pointerEvents = 'none';
}

// Attach it
bonus1.addEventListener('click', handleBonus1);

function handleBonus2() {
    applyBonus(0);
  if (foundPanelImgs[2]) {
    foundPanelImgs[2].classList.add('found');
    if (!foundIndices.includes(2)) {
  foundIndices.push(2);
  localStorage.setItem('foundIndices', JSON.stringify(foundIndices));
}
}
  usedBonuses.push('bonus-zone-2');
  localStorage.setItem('usedBonuses', JSON.stringify(usedBonuses));
  disableZone(bonus2);
  bonus2.removeEventListener('click', handleBonus2);
let bonus2Count = parseInt(localStorage.getItem('bonus2Count') || '0', 10);
  bonus2Count++;
  localStorage.setItem('bonus2Count', bonus2Count);
  			// bonus2.removeEventListener('click', handleBonus2);
 			// bonus2.style.opacity = '0.3';
 			// bonus2.style.pointerEvents = 'none';
}

bonus2.addEventListener('click', handleBonus2);









function applyBonus(msBonus) {
  if (!timerRunning) return;
  bonusAccum += msBonus;
localStorage.setItem('bonusAccum', bonusAccum);
  // Optional: give instant visual feedback:
  // e.g. flash the zone, show “–0.1s” text, etc.
console.log(`BONUS CLICKED: –${msBonus} ms | total bonusAccum = ${bonusAccum} ms`);
}
const statsBtn = document.getElementById('stats-btn');
document.addEventListener('DOMContentLoaded', () => {


statsBtn.addEventListener('click', () => {
  if (!lastResult) return;
  // re-render the modal contents from lastResult
  renderStats(lastResult);
  timerModal.style.display = 'flex';
});
});

function resetRunState() {
  // 1) Clear any per-run storage
  localStorage.removeItem('usedBonuses');
localStorage.removeItem('foundIndices');
  localStorage.removeItem('gameStart');
  localStorage.removeItem('startDay');
  localStorage.removeItem('bonusAccum');
  bonusAccum = 0;
 foundIndices = [];
  // 2) Re-enable & re-style both bonus zones
  [bonus1, bonus2].forEach(zone => {
    zone.style.pointerEvents = '';
    zone.style.opacity       = '0.8';
    // re-attach their handlers if you removed them
  });

  // 3) Clear “found” marks from the panel
  foundPanelImgs.forEach(img => img.classList.remove('found'));
   [bonus1,bonus2].forEach(zone => {
    zone.style.pointerEvents = '';
    zone.style.opacity       = '0.8';
})};






    // Start game
    function startGame() {
resetRunState();
// in test mode we skip this check (see next section)
  if (!testMode) {
   
    const last = localStorage.getItem('lastPlayedDay');
    if (last === todayKey) {
      alert("You've already played today—come back tomorrow!");
      return;
    }
  }
  
  else {
    // in test, check timestamp instead of date:
    const lastTs = parseInt(localStorage.getItem('lastPlayTs')||'0',10);
    if (Date.now() - lastTs < testDuration) {
      const secsLeft = ((testDuration - (Date.now()-lastTs))/1000).toFixed(0);
      alert(`Test lockout: try again in ${secsLeft}s`);
      return;
    }
  }
  // proceed with starting…
  introModal.style.display = 'none';
  startTime       = Date.now();
  timerRunning    = true;
  localStorage.setItem('gameStart', startTime);
  localStorage.setItem('startDay',  todayKey /*new Date().toISOString().slice(0,10)*/);
  localStorage.setItem('bonusAccum', bonusAccum);


     
      document.querySelectorAll(".game-button").forEach(btn =>
  btn.classList.remove("blurred")
);
     
const today = new Date().toISOString().slice(0,10);

    }
    startBtn.addEventListener('click', startGame);
    introModal.addEventListener('click', (e) => {
      if (e.target === introModal) startGame();
    });

    // Stop timer on target click
    clickZone.addEventListener('click', () => {
	
      if (!timerRunning) return;
      elapsed = Date.now() - startTime;
      timerRunning = false;
      //showModal(elapsed);
      lastResult = computeResults(elapsed);
      renderStats(lastResult);


localStorage.setItem('lastPlayedDay', todayKey);





      timerModal.style.display = 'flex';
  statsBtn.style.display = 'block';
  localStorage.setItem('lastResult', JSON.stringify(lastResult));
 if (foundPanelImgs.length > 0) {
        foundPanelImgs[0].classList.add('found');
        if (!foundIndices.includes(0)) {
  foundIndices.push(0);
  localStorage.setItem('foundIndices', JSON.stringify(foundIndices));
}
}
    });

    // Close timer modal via button
    xbtn.addEventListener('click', () => {
      timerModal.style.display = 'none';
      document.querySelectorAll(".game-button").forEach(btn =>
  btn.classList.remove("blurred")
);
});

closeBtn.addEventListener('click', () => {
  const shareData = {
    title: document.title,
    text: 'I just played the Daily Hidden Object Game! Can you beat my time?',
    url: location.href
  };

   // only invoke native share on (likely) mobile
  if (navigator.share && isMobile) {
    navigator.share(shareData)
      .catch(err => console.error('Share failed:', err));
  } else {
    // desktop fallback: copy link + a friendly in-page toast
    copyLinkToClipboard(shareData.url);
    showCopyToast2();  
  }
});



    // Close timer modal by clicking outside content
    timerModal.addEventListener('click', (e) => {
      if (e.target === timerModal) {
        timerModal.style.display = 'none';
        document.querySelectorAll(".game-button").forEach(btn =>
  btn.classList.remove("blurred")
);
      }
    });

              // Display elapsed time

              function computeResults(ms) {
  // 1) net time
  const netMs = ms - bonusAccum;

  // 2) pick medal
  let medal;
  if      (netMs <    0) medal = 'amethyst';
  else if (netMs <= 5000) medal = 'gold';
  else if (netMs <=10000) medal = 'silver';
  else                    medal = 'bronze';

  // 3) update medal counts
  const counts = JSON.parse(
    localStorage.getItem('medalCounts')
    || '{"amethyst":0,"gold":0,"silver":0,"bronze":0}'
  );
  counts[medal]++;
  localStorage.setItem('medalCounts', JSON.stringify(counts));

  // 4) record today’s bonus-2 count and scores
  const bonus2Count = parseInt(localStorage.getItem('bonus2Count')||'0', 10);
  const bonus1Count = parseInt(localStorage.getItem('bonus1Count')||'0', 10);
  const today = new Date().toISOString().slice(0,10);
  let scores = JSON.parse(localStorage.getItem('scores')||'[]');
  scores.push({ date: today, time: netMs });
  localStorage.setItem('scores', JSON.stringify(scores));

  // 5) compute streaks
  const dateSet = new Set(scores.map(e => e.date));
  const daysPlayed = dateSet.size;

  let streak = 0;
  for (let i = 0; ; i++) {
    const d = new Date(); d.setDate(d.getDate() - i);
    if (dateSet.has(d.toISOString().slice(0,10))) streak++;
    else break;
  }

  let longestStreak = 0;
  for (let dStr of dateSet) {
    const prev = new Date(dStr); prev.setDate(prev.getDate()-1);
    const prevKey = prev.toISOString().slice(0,10);
    if (!dateSet.has(prevKey)) {
      let run=1, nxt=new Date(dStr);
      while (true) {
        nxt.setDate(nxt.getDate()+1);
        if (dateSet.has(nxt.toISOString().slice(0,10))) run++;
        else break;
      }
      longestStreak = Math.max(longestStreak, run);
    }
  }
if (testMode) {
  localStorage.setItem('lastPlayTs', Date.now());
} else {
  // the daily version
  const todayKey ='2025-7';// new Date().toISOString().slice(0,10);
  localStorage.setItem('lastPlayedDay', todayKey);
}

  // 6) clear per-run storage & lock today
//  localStorage.setItem('lastPlayedDay', today);
  ['gameStart','startDay','bonusAccum',].forEach(k =>
    localStorage.removeItem(k));

  return { netMs, medal, counts,bonus1Count, bonus2Count, daysPlayed, streak, longestStreak };
}

function renderStats(r) {
  const { medal } = r; 
  const modalContent = document.getElementById('modal-content');
  // clear everything except the Close button
  //modalContent.querySelector('#results-body').innerHTML = '';
  const resultsBody = document.getElementById('results-body');
resultsBody.innerHTML = '';
  // time
  const totalMs = r.netMs;

// 1) compute each unit
const minutes   = Math.floor(totalMs / 60000);
const seconds   = Math.floor((totalMs % 60000) / 1000);
const centisecs = Math.floor((totalMs % 1000) / 10);  // two-digit centiseconds

// 2) pad to two digits
const mm = String(minutes).padStart(2, '0');
const ss = String(seconds).padStart(2, '0');
const cs = String(centisecs).padStart(2, '0');
  const secs = (r.netMs/1000).toFixed(3);
 

  // big medal
  resultsBody.insertAdjacentHTML('beforeend',
    `<img src="${r.medal}big.png" class="medal-large medal-${r.medal}" alt="${r.medal} medal">`
  );
resultsBody.insertAdjacentHTML('beforeend',
  `<p id="time-display"> ${mm}:${ss}:${cs} <br> </p>`
);
  
resultsBody.insertAdjacentHTML('beforeend', `
  <div id="score-stats">
    <div class="stat-block">
      <span class="stat-value">${r.daysPlayed}</span>
      <span class="stat-label">Days<br> Played</span>
    </div>
    <div class="stat-block">
      <span class="stat-value">${r.streak}</span>
      <span class="stat-label">Current<br> Streak</span>
    </div>
    <div class="stat-block">
      <span class="stat-value">${r.longestStreak}</span>
      <span class="stat-label">Max<br> Streak</span>
    </div>
  </div>
`);
  
  
const counts = r.counts;
const medals = ['amethyst','gold','silver','bronze'];
const maxCount = Math.max(...medals.map(m => counts[m]));
resultsBody.insertAdjacentHTML('beforeend', `
  <div id="medal-bars">
 ${medals.map(medal => {
      // ← per-item check happens here:
      const isCurrent = (medal === r.medal) ? ' current' : '';
      const pct = maxCount > 0
        ? (counts[medal] / maxCount * 100).toFixed(2)
        : 0;
      
      return `
        <div class="bar-row bar-${medal}${isCurrent}">
          <img src="${medal}.png?v=3" alt="${medal} medal">
          <div class="bar-container">
            <div class="bar-fill" style="width: ${pct}%"></div>
          </div>
          <span class="bar-value">${counts[medal]}</span>
        </div>
      `;
    }).join('')}
  </div>
`);



resultsBody.insertAdjacentHTML('beforeend', `
    <div id="medal-stats">
  
  <div class="stat-row">
    <img src="bonus2-icon.png?v=1" alt="Bonus 2">
    <span class="stat-row">${r.bonus2Count}</span>
    </div>
    <div class="stat-row">
    <img src="calendar.png" alt="Bonus 1">
    <span class="stat-row">${r.bonus1Count}</span>
  </div>
  
</div>
  `);
















 
  // score stats
  
  document.querySelectorAll(".game-button").forEach(btn =>
  btn.classList.add("blurred"));
}

const shareBtn = document.getElementById('share-btn');
const isMobile = /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);

shareBtn.addEventListener('click', () => {
  const shareData = {
    title: document.title,
    text: 'I just played the Daily Hidden Object Game! Can you beat my time?',
    url: location.href
  };

   // only invoke native share on (likely) mobile
  if (navigator.share && isMobile) {
    navigator.share(shareData)
      .catch(err => console.error('Share failed:', err));
  } else {
    // desktop fallback: copy link + a friendly in-page toast
    copyLinkToClipboard(shareData.url);
    showCopyToast();  
  }
});

function showCopyToast() {
  const toast = document.createElement('div');
  toast.textContent = 'Link copied to clipboard!';
  toast.style = `
    position: fixed;
    bottom: 27px;
    right: 1295px;
    background: var(--accent);
    color: #fff;
    padding: 8px 12px;
    border-radius: 4px;
    opacity: 0;
    transition: opacity 0.3s;
    z-index: 1200;
  `;
  document.body.appendChild(toast);
  // fade in
  requestAnimationFrame(() => toast.style.opacity = 1);
  // remove after 2s
  setTimeout(() => {
    toast.style.opacity = 0;
    toast.addEventListener('transitionend', () => toast.remove());
  }, 1500);
}
function showCopyToast2() {
  const toast = document.createElement('div');
  toast.textContent = 'Link copied to clipboard!';
  toast.style = `
    position: fixed;
    bottom: 180px;
    right: 850px;
    background: var(--accent);
    color: #fff;
    padding: 8px 12px;
    border-radius: 4px;
    opacity: 0;
    transition: opacity 0.3s;
    z-index: 1200;
  `;
  document.body.appendChild(toast);
  // fade in
  requestAnimationFrame(() => toast.style.opacity = 1);
  // remove after 2s
  setTimeout(() => {
    toast.style.opacity = 0;
    toast.addEventListener('transitionend', () => toast.remove());
  }, 1500);
}
// simple clipboard copy
function copyLinkToClipboard(link) {
  const tmp = document.createElement('textarea');
  tmp.value = link;
  document.body.appendChild(tmp);
  tmp.select();
  document.execCommand('copy');
  document.body.removeChild(tmp);
}
  </script>
</body>
</html>
